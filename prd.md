# DictCLI – LLM‑First Dictation TUI App **PRD v1.2**

## 1 背景・目的
日本人英語学習者が「**聞く → 書く → 確認する**」ディクテーション・ループを高速に回すには、ブラウザ依存の UI では集中力が途切れやすい。`DictCLI` は **キーボード完結の TUI** と **LLM 主体の教材生成・日本語での自動採点・TTS** により、1 分未満でラウンドを回し学習効率を最大化する。

## 2 ゴール & KPI
| 目標 | 指標 | 初期目標値 |
|------|------|------------|
| 学習継続率 | 7 日後継続率 | ≥ 40 % |
| 学習回転数 | 1 セッションあたり完了ラウンド数 | ≥ 5 |
| 学習効率 | WER* 改善幅（30 ラウンド平均） | −10 %以上 |

\*WER = Word Error Rate

## 3 ターゲットユーザ / ペルソナ
| ペルソナ | プロフィール | ペイン | ジョブ to be Done |
|-----------|-------------|--------|-------------------|
| **Yuki (24)** | Web エンジニア・TOEIC 650 | 学習時間が細切れ | コード間の隙間時間で耳を鍛えたい |
| **Ken (31)** | コンサルタント・TOEIC 840 | シャドーイング伸び悩み | 聞き取りミスを定量把握したい |

## 4 ユーザーストーリー
1. **短時間学習** — < 1 min/round  
2. **弱点把握** — 誤認語の自動抽出  
3. **段階的難易度** — Gap‑fill → Full sentence  
4. **モチベ継続** — スコア推移の可視化  

## 5 プロダクト方針：LLM‑First アーキテクチャ
| 処理 | OpenAI API | 役割 |
|------|-----------|------|
| **問題生成** | Chat Completions | CEFR レベル & トピックで英文を生成 |
| **音声生成** | Audio TTS | 英文を即時 MP3 変換し再生 |
| **採点** | Chat Completions | 参照文と入力を比較して WER・誤語列・代替例を返す（日本語解説付き） |

> 各ラウンドで LLM を最低 2 回呼び出す（生成・採点）。TTS はキャッシュ戦略でコストを最適化。

## 6 MVP スコープ
### 6.1 コア機能
| # | 機能 | LLM 関与 | 説明 |
|---|------|----------|------|
| F‑1 | 問題文生成 | ✅ | レベル・トピック選択で 1 文生成 |
| F‑2 | 音声生成／再生 | ✅ | 速度 0.8×–1.2×、ローカル再生 |
| F‑3 | 入力受付 | – | テキスト入力で回答を受け付け |
| F‑4 | 採点 & フィードバック | ✅ | WER、誤語ハイライト（日本語解説）、代替表現 |
| F‑5 | 結果履歴 | – | ローカル JSONL に保存 |
| F‑6 | 再試聴 / ギブアップ | – | リプレイ／Gap‑fill／原文開示 |
| F‑7 | 設定保存 | – | Voice / Level / Topic / Length 永続化 |

### 6.2 非機能要件
* 起動 ≤ 500 ms、LLM 待機以外の応答 ≤ 100 ms  
* オフライン時はキャッシュ済み問題で動作  
* API キーは OS Keychain などに暗号化保存  
* 入力テキストはローカルのみ保存（プライバシー確保）

### 6.3 範囲外（v1）
* 音声入力シャドーイング  
* クラウド同期・ランキング  
* GUI／モバイル版

## 7 画面構成

### 7.1 学習ビュー（起動直後）
```
┌ DictCLI ─ Voice:TOM | Level:TOEIC700 | Topic:Business | Length:15w ─┐
│ (🔊 Playing… ⏩0.9×  [R]eplay  [S]Settings  [Q]Quit)                │
│──────────────────────────────────────────────────────────────────────│
│ > cursor here                                                        │
└──────────────────────────────────────────────────────────────────────┘
```
* 起動と同時に LLM で英文生成 → TTS 再生 → 入力受付開始

### 7.2 採点結果ビュー
```
┌ DictCLI ─ Voice:TOM | Level:TOEIC700 | Topic:Business | Length:15w ─┐
│ Score: 82 %  WER 0.18   [N]Next  [R]Replay  [S]Set                  │
│──────────────────────────────────────────────────────────────────────│
│ 誤り: be → am  (be動詞の活用ミス)                                    │
│ 正解: I **am going** to the beach tomorrow                           │
│ 別解1: I'm heading to the beach tomorrow                             │
│ 別解2: I'll be at the beach tomorrow                                 │
└──────────────────────────────────────────────────────────────────────┘
```

### 7.3 Settings モーダル
```
┌ Settings ──────────────────────────────┐
│ Voice  : TOM      (←/→)   ♂/♀ voices   │
│ Level  : TOEIC700 (←/→)  400‑990       │
│ Topic  : Business (←/→)  選択可能      │
│ Length : 15 words (−/＋)  5–30         │
│────────────────────────────────────────│
│ [Enter] Save & Next Round   [Esc] Cancel│
└────────────────────────────────────────┘
```

## 8 状態遷移図
```
Startup → Listening/Input ↔ Result
                 ▲  │S                 │
                 │  ▼                  │
                 └ Settings ───────────┘
```

## 9 デフォルト設定
| 項目 | 値 |
|------|-----|
| Voice | **TOM** (男性) |
| Level | **TOEIC 700** 相当 |
| Topic | **Business** (ビジネス) |
| Length | **15 words** |

### 9.1 選択可能なトピック
- **Business** (ビジネス・仕事)
- **Travel** (旅行・観光)
- **Daily** (日常生活)
- **Technology** (技術・IT)
- **Health** (健康・医療)

## 10 リスク & 対策
| リスク | 影響 | 対策 |
|--------|------|------|
| API 料金高騰 | 継続利用困難 | TTS キャッシュ・文字数制限 |
| LLM 応答揺らぎ | 採点の一貫性 | プロンプト固定・temperature 0 |
| ネットワーク障害 | 学習停止 | ローカルキャッシュ fallback |
| プライバシー懸念 | ユーザ離脱 | 入力データをクラウド送信しない |

---

### Appendix
*WER (Word Error Rate) = (挿入＋削除＋置換) ÷ 参照語数  
*CEFR = Common European Framework of Reference*