# DictCLI – LLM-First Dictation TUI App **PRD v1.3**

## 1 背景・目的
日本人英語学習者が「**聞く → 書く → 確認する**」ディクテーション・ループを高速に回すには、ブラウザ依存の UI では集中力が途切れやすい。`DictCLI` は **キーボード完結の TUI** と **LLM 主体の教材生成・日本語での自動採点・TTS** により、1 分未満でラウンドを回し学習効率を最大化する。
CIの待ち時間にサクッとdictationだ!
対象は日本人（日本語話者）とする

## 2 ゴール & KPI
| 目標 | 指標 | 初期目標値 |
|------|------|------------|
| 学習継続率 | 7 日後継続率 | ≥ 40 % |
| 学習回転数 | 1 セッションあたり完了ラウンド数 | ≥ 5 |
| 学習効率 | WER* 改善幅（30 ラウンド平均） | −10 %以上 |

*WER = Word Error Rate

## 3 ターゲットユーザ / ペルソナ
| ペルソナ | プロフィール | ペイン | ジョブ to be Done |
|-----------|-------------|--------|-------------------|
| **Yuki (24)** | Web エンジニア・TOEIC 650 | 学習時間が細切れ | コード間の隙間時間で耳を鍛えたい |
| **Ken (31)** | コンサルタント・TOEIC 840 | シャドーイング伸び悩み | 聞き取りミスを定量把握したい |

## 4 ユーザーストーリー
1. **短時間学習** — < 1 min/round  
2. **弱点把握** — 誤認語の自動抽出  
3. **段階的難易度** — Gap-fill → Full sentence  
4. **モチベ継続** — スコア推移の可視化  

## 5 プロダクト方針：LLM-First アーキテクチャ
| 処理 | OpenAI API | 役割 |
|------|-----------|------|
| **問題生成** | Chat Completions | CEFR レベル & トピックで英文を生成 A1からスタート|
| **音声生成** | Audio TTS | 英文を即時 MP3 変換し再生 |
| **採点** | Chat Completions | 参照文と入力を比較して WER・誤語列・代替例を返す（日本語解説付き） |

> 各ラウンドで LLM を最低 2 回呼び出す（生成・採点）。TTS はキャッシュ戦略でコストを最適化。

## 6 MVP スコープ
### 6.1 コア機能
| # | 機能 | LLM 関与 | 説明 |
|---|------|----------|------|
| F-1 | 問題文生成 | ✅ | レベル・トピック選択で 1 文生成 |
| F-2 | 音声生成／再生 | ✅ | 速度 0.8×–1.2×、ローカル再生 |
| F-3 | 入力受付 | – | テキスト入力で回答を受け付け |
| F-4 | 採点 & フィードバック | ✅ | WER、誤語ハイライト（日本語解説）、代替表現 |
| F-5 | 結果履歴 | – | ローカル JSONL に保存 |
| F-6 | 再試聴 / ギブアップ | – | リプレイ／Gap-fill／原文開示 |
| F-7 | 設定保存 | – | Voice / Level / Topic / Length 永続化 |

### 6.2 非機能要件
* 起動 ≤ 500 ms、LLM 待機以外の応答 ≤ 100 ms   
* API キーは ENV(OPENAI_API_KEY)から読み込む  
* 入力テキストはローカルのみ保存（プライバシー確保）

### 6.3 範囲外（v1）
* 音声入力シャドーイング  
* クラウド同期・ランキング  
* GUI／モバイル版
* 誤りを元に問題を生成
* テーマカラーの変更
* 過去の問題/回答の閲覧
* デフォルト言語の変更（日本語以外）
* GEMINI対応

## 7 画面構成

### 7.1 学習ビュー（起動直後）
```
┌ DictCLI ─ Voice:ALEX | Level:CEFR_A1 | Topic:Business | Length:10w ─┐
│ (🔊 Playing… ⏩1.0×)                                                  │
│──────────────────────────────────────────────────────────────────────│
│ > cursor here                                                        │
└──────────────────────────────────────────────────────────────────────┘
```
* 起動と同時に LLM で英文生成 → TTS 再生 → 入力受付開始  
* **スラッシュコマンド方式**を採用：`/replay`, `/settings`, `/quit`, `/giveup` など
* **"/"入力時に自動補完メニュー表示**：
  - `/` を入力した瞬間、利用可能なコマンドがドロップダウン形式で表示される
  - 上下矢印キーでコマンドを選択、Enterで実行
  - 各コマンドには説明文を併記（例：`/replay` → "Replay the audio"）
  - 入力に応じてリアルタイムフィルタリング

#### スラッシュコマンドメニュー表示例
```
┌ DictCLI ─ Voice:ALEX | Level:CEFR_A1 | Topic:Business | Length:10w ─┐
│ (🔊 Playing… ⏩1.0×)                                                  │
│──────────────────────────────────────────────────────────────────────│
│ > /                                                                  │
│ ┌─────────────────────────────────────────┐                         │
│ │ /replay     Replay the audio            │                         │
│ │ /settings   Open settings panel         │                         │
│ │ /giveup     Show answer with gaps       │                         │
│ │ /quit       Exit the application        │                         │
│ └─────────────────────────────────────────┘                         │
└──────────────────────────────────────────────────────────────────────┘
```

### 7.2 採点結果ビュー
```
┌ DictCLI ─ Voice:ALEX | Level:CEFR_A1 | Topic:Business | Length:10w ─┐
│ Score: 82 %  WER 0.18                                                │
│──────────────────────────────────────────────────────────────────────│
│ 誤り: be → am  (be動詞の活用ミス)                                    │
│ 正解: I **am going** to the beach tomorrow                           │
│ 別解1: I'm heading to the beach tomorrow                             │
│ 別解2: I'll be at the beach tomorrow                                 │
│──────────────────────────────────────────────────────────────────────│
│ Press Enter for next round  (or N/R/S/Q for other actions)          │
└──────────────────────────────────────────────────────────────────────┘
```
* **ハイブリッド操作方式**を採用：
  - **Enter キー**: 次のラウンドへ進む（最も一般的な操作）
  - **単一キーショートカット**: 
    - `N`: Next round（Enterと同じ）
    - `R`: Replay audio
    - `S`: Settings
    - `Q`: Quit application
  - スラッシュコマンドは不要とし、学習フローを妨げない

### 7.3 Settings モーダル
```
┌ Settings ──────────────────────────────┐
│ Voice  : ALEX     (←/→)   ♂/♀ voices   │
│ Level  : CEFR_A1 (←/→)  A1 B1 B2 C1 C2 │
│ Topic  : Business (←/→)  選択可能      │
│ Length : 10 words (−/＋)  5–30         │
│────────────────────────────────────────│
│ [Enter] Save & Next Round   [Esc] Cancel│
└────────────────────────────────────────┘
```

## 8 状態遷移図
```
Startup → Listening/Input ↔ Result
                ▲  │S                 │
                │  ▼                  │
                └ Settings ───────────┘
```

## 9 デフォルト設定
| 項目 | 値 |
|------|-----|
| Voice | **ALEX** (男性) |
| Level | **CEFR_A1** 相当 |
| Topic | **Business** (ビジネス) |
| Length | **10 words** |

### 9.1 選択可能なトピック
- **Business** (ビジネス・仕事)
- **Tech** (ソフトウェア開発)
- **Travel** (旅行・観光)
- **Daily** (日常生活)
- **Technology** (技術・IT)
- **Health** (健康・医療)

### 9.2 音声マッピング
| 表示名 | 性別 | OpenAI音声名 | 説明 |
|--------|------|--------------|------|
| **ALEX** | 男性 | alloy | デフォルト音声、親しみやすい男性音声 |
| **SARA** | 女性 | shimmer | クリアで聞き取りやすい女性音声 |
| EVAN | 男性 | echo | 落ち着いた男性音声 |
| NOVA | 女性 | nova | モダンな女性音声 |
| NICK | 男性 | onyx | 深みのある男性音声 |
| FAYE | 女性 | fable | 優しい女性音声 |

## 10 CLI
```
$ dictcli --topic tech --level cefr_a1 --words 12 --voice sara 
```

## 11 カラー

BLUEとする

## 12 Debug Mode

起動時、DEBUGログを上部に固定で表示させる
これによりPrint Debugが容易になり、Coding Agent AIが課題解決しやすくなる
ただし、本番用のBuildでは除外する必要がある

## 13 利用するLLMモデル

### OpenAI
- gpt-4o-mini-tts / gpt-4o-mini

### Gemini
- TBD: 今回は対象外である
